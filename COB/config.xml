<?xml version="1.0" encoding="UTF-8"?>

<appConfig xmlns="http://example.org/appconfig/v1"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://example.org/appconfig/v1 appconfig-v1.xsd">

  <meta>
    <app>
      <name>Acme-Orion</name>
      <systemId>orion</systemId>
      <environment>UAT</environment>
      <region>ap-south-1</region>
      <ownerTeam>platform-observability</ownerTeam>
      <costCenter>CC-OPS-1042</costCenter>
      <build>
        <version>2.17.0-uat</version>
        <gitCommit>9f3a8c1fdb4e2e17d0aa7b72e59b9c79b7c12abc</gitCommit>
        <buildDate>2026-02-02</buildDate>
        <artifact>orion-service.jar</artifact>
      </build>
    </app>

    <runtime>
      <timezone>Asia/Kolkata</timezone>
      <locale>en_IN</locale>
      <startMode>clustered</startMode>
      <minInstances>2</minInstances>
      <maxInstances>8</maxInstances>
      <shutdownGraceSeconds>45</shutdownGraceSeconds>
    </runtime>

    <contacts>
      <onCall>
        <primary>orion-uat-oncall</primary>
        <secondary>orion-platform-backup</secondary>
      </onCall>
      <slack>
        <channel>#orion-uat-alerts</channel>
        <webhookSecretRef>secret://slack/uat/orion-alerts</webhookSecretRef>
      </slack>
      <email>
        <distributionList>orion-uat@acme.example</distributionList>
      </email>
    </contacts>
  </meta>

  <global>
    <maintenanceMode enabled="false">
      <bannerText>UAT maintenance scheduled. Expect intermittent errors.</bannerText>
      <allowedIps>
        <ip>10.10.0.0/16</ip>
        <ip>172.16.10.0/24</ip>
      </allowedIps>
    </maintenanceMode>

    <idGeneration>
      <strategy>snowflake</strategy>
      <nodeId>17</nodeId>
      <datacenterId>3</datacenterId>
    </idGeneration>

    <clockSkew>
      <maxAllowedSeconds>5</maxAllowedSeconds>
      <rejectIfBeyond>true</rejectIfBeyond>
    </clockSkew>

    <headers>
      <default>
        <header name="X-App-Name" value="Acme-Orion"/>
        <header name="X-Env" value="UAT"/>
        <header name="X-Region" value="ap-south-1"/>
      </default>
      <forwarded>
        <honorXForwardedFor>true</honorXForwardedFor>
        <trustedProxies>
          <cidr>10.10.0.0/16</cidr>
          <cidr>172.16.0.0/12</cidr>
        </trustedProxies>
      </forwarded>
    </headers>
  </global>

  <http>
    <server>
      <listenHost>0.0.0.0</listenHost>
      <listenPort>8081</listenPort>
      <adminPort>9081</adminPort>
      <contextPath>/orion</contextPath>

      <tls enabled="true">
        <protocols>
          <protocol>TLSv1.2</protocol>
          <protocol>TLSv1.3</protocol>
        </protocols>
        <keystore>
          <type>PKCS12</type>
          <path>/etc/orion/uat/tls/orion-uat.p12</path>
          <passwordRef>secret://tls/orion/uat/keystore_password</passwordRef>
        </keystore>
        <truststore>
          <type>JKS</type>
          <path>/etc/orion/uat/tls/truststore.jks</path>
          <passwordRef>secret://tls/orion/uat/truststore_password</passwordRef>
        </truststore>
        <clientAuth>optional</clientAuth>
      </tls>

      <compression enabled="true">
        <minSizeBytes>2048</minSizeBytes>
        <mimeTypes>
          <mime>application/json</mime>
          <mime>application/xml</mime>
          <mime>text/plain</mime>
          <mime>text/html</mime>
        </mimeTypes>
      </compression>

      <limits>
        <maxHeaderSizeBytes>32768</maxHeaderSizeBytes>
        <maxRequestSizeBytes>10485760</maxRequestSizeBytes>
        <maxFormContentSizeBytes>5242880</maxFormContentSizeBytes>
        <maxConnections>8000</maxConnections>
        <idleTimeoutMs>65000</idleTimeoutMs>
        <requestTimeoutMs>45000</requestTimeoutMs>
        <keepAlive enabled="true">
          <maxRequestsPerConnection>500</maxRequestsPerConnection>
        </keepAlive>
      </limits>
    </server>

    <clientDefaults>
      <connectTimeoutMs>3000</connectTimeoutMs>
      <readTimeoutMs>9000</readTimeoutMs>
      <maxRetries>2</maxRetries>
      <retryBackoffMs>250</retryBackoffMs>
      <circuitBreaker>
        <enabled>true</enabled>
        <failureThreshold>10</failureThreshold>
        <rollingWindowSeconds>30</rollingWindowSeconds>
        <openStateSeconds>25</openStateSeconds>
        <halfOpenMaxCalls>5</halfOpenMaxCalls>
      </circuitBreaker>
    </clientDefaults>
  </http>

  <security>
    <auth>
      <mode>OIDC</mode>
      <oidc>
        <issuer>https://idp-uat.acme.example/oauth2/default</issuer>
        <jwksUri>https://idp-uat.acme.example/oauth2/default/v1/keys</jwksUri>
        <audience>orion-uat</audience>
        <clientId>orion-uat-web</clientId>
        <clientSecretRef>secret://oidc/uat/orion_web_client_secret</clientSecretRef>
        <scopes>
          <scope>openid</scope>
          <scope>profile</scope>
          <scope>email</scope>
          <scope>groups</scope>
        </scopes>
        <claims>
          <subject>sub</subject>
          <email>email</email>
          <groups>groups</groups>
        </claims>
        <clockSkewSeconds>10</clockSkewSeconds>
      </oidc>

      <jwt>
        <algorithm>RS256</algorithm>
        <required>true</required>
        <allowInQueryParam>false</allowInQueryParam>
        <headerName>Authorization</headerName>
        <tokenPrefix>Bearer </tokenPrefix>
      </jwt>
    </auth>

    <authorization>
      <rbac enabled="true">
        <defaultRole>viewer</defaultRole>
        <roles>
          <role name="viewer">
            <permissions>
              <permission>read:dashboards</permission>
              <permission>read:reports</permission>
              <permission>read:configs</permission>
            </permissions>
          </role>

          <role name="analyst">
            <permissions>
              <permission>read:dashboards</permission>
              <permission>read:reports</permission>
              <permission>write:feedback</permission>
              <permission>read:anomalies</permission>
            </permissions>
          </role>

          <role name="admin">
            <permissions>
              <permission>*</permission>
            </permissions>
            <requiresMfa>true</requiresMfa>
          </role>
        </roles>

        <groupMappings>
          <mapping group="orion-uat-viewers" role="viewer"/>
          <mapping group="orion-uat-analysts" role="analyst"/>
          <mapping group="orion-uat-admins" role="admin"/>
        </groupMappings>
      </rbac>

      <ipAllowlist enabled="false">
        <allowedCidrs>
          <cidr>10.10.0.0/16</cidr>
          <cidr>172.16.10.0/24</cidr>
        </allowedCidrs>
      </ipAllowlist>
    </authorization>

    <secrets>
      <provider>file</provider>
      <fileProvider>
        <basePath>/etc/orion/uat/secrets</basePath>
        <fileMode>0400</fileMode>
      </fileProvider>
      <redaction>
        <enabled>true</enabled>
        <patterns>
          <pattern>\bAKIA[0-9A-Z]{16}\b</pattern>
          <pattern>\b(?:password|passwd|pwd)\s*=\s*[^&amp;\s]+\b</pattern>
          <pattern>\bBearer\s+[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+\b</pattern>
        </patterns>
      </redaction>
    </secrets>
  </security>

  <datastores>
    <postgres name="primary">
      <host>pg-uat.acme.example</host>
      <port>5432</port>
      <database>orion_uat</database>
      <schema>public</schema>
      <username>orion_uat_app</username>
      <passwordRef>secret://db/uat/orion_uat_app_password</passwordRef>

      <pool>
        <minConnections>3</minConnections>
        <maxConnections>40</maxConnections>
        <connectionTimeoutMs>3000</connectionTimeoutMs>
        <idleTimeoutMs>600000</idleTimeoutMs>
        <maxLifetimeMs>1800000</maxLifetimeMs>
        <validationQuery>SELECT 1</validationQuery>
      </pool>

      <ssl>
        <enabled>true</enabled>
        <mode>verify-full</mode>
        <rootCertPath>/etc/orion/uat/db/ca.pem</rootCertPath>
      </ssl>

      <migrations>
        <enabled>true</enabled>
        <tool>flyway</tool>
        <locations>
          <location>classpath:db/migration/common</location>
          <location>classpath:db/migration/uat</location>
        </locations>
      </migrations>
    </postgres>

    <redis name="cache">
      <mode>sentinel</mode>
      <sentinel>
        <masterName>orion-uat-master</masterName>
        <nodes>
          <node>redis-s1-uat.acme.example:26379</node>
          <node>redis-s2-uat.acme.example:26379</node>
          <node>redis-s3-uat.acme.example:26379</node>
        </nodes>
      </sentinel>

      <auth>
        <passwordRef>secret://redis/uat/password</passwordRef>
      </auth>

      <timeouts>
        <connectMs>1500</connectMs>
        <readMs>2000</readMs>
        <writeMs>2000</writeMs>
      </timeouts>

      <cachePolicies>
        <policy name="session">
          <ttlSeconds>3600</ttlSeconds>
          <maxEntries>150000</maxEntries>
          <eviction>volatile-lru</eviction>
        </policy>
        <policy name="featureFlags">
          <ttlSeconds>120</ttlSeconds>
          <maxEntries>50000</maxEntries>
          <eviction>allkeys-lfu</eviction>
        </policy>
        <policy name="lookup">
          <ttlSeconds>900</ttlSeconds>
          <maxEntries>250000</maxEntries>
          <eviction>allkeys-lru</eviction>
        </policy>
      </cachePolicies>
    </redis>

    <objectStore name="artifacts">
      <provider>s3</provider>
      <s3>
        <bucket>acme-orion-uat-artifacts</bucket>
        <region>ap-south-1</region>
        <endpoint>https://s3.ap-south-1.amazonaws.com</endpoint>
        <pathStyleAccess>false</pathStyleAccess>
        <serverSideEncryption>AES256</serverSideEncryption>
        <kmsKeyId></kmsKeyId>
      </s3>

      <uploads>
        <maxFileSizeBytes>52428800</maxFileSizeBytes>
        <allowedMimeTypes>
          <mime>application/json</mime>
          <mime>application/xml</mime>
          <mime>text/plain</mime>
          <mime>application/zip</mime>
        </allowedMimeTypes>
      </uploads>
    </objectStore>
  </datastores>

  <messaging>
    <kafka>
      <enabled>true</enabled>
      <bootstrapServers>
        <server>kafka1-uat.acme.example:9093</server>
        <server>kafka2-uat.acme.example:9093</server>
        <server>kafka3-uat.acme.example:9093</server>
      </bootstrapServers>

      <security>
        <protocol>SASL_SSL</protocol>
        <saslMechanism>SCRAM-SHA-512</saslMechanism>
        <username>orion-uat-kafka</username>
        <passwordRef>secret://kafka/uat/password</passwordRef>
      </security>

      <topics>
        <topic name="orion.events.audit" partitions="6" replicationFactor="2"/>
        <topic name="orion.events.anomaly" partitions="12" replicationFactor="2"/>
        <topic name="orion.events.feedback" partitions="6" replicationFactor="2"/>
        <topic name="orion.events.notifications" partitions="6" replicationFactor="2"/>
      </topics>

      <producer>
        <acks>all</acks>
        <lingerMs>10</lingerMs>
        <batchSizeBytes>65536</batchSizeBytes>
        <compressionType>lz4</compressionType>
        <retries>3</retries>
        <deliveryTimeoutMs>120000</deliveryTimeoutMs>
      </producer>

      <consumer>
        <groupId>orion-uat-consumers</groupId>
        <autoOffsetReset>earliest</autoOffsetReset>
        <maxPollRecords>500</maxPollRecords>
        <sessionTimeoutMs>15000</sessionTimeoutMs>
        <maxPartitionFetchBytes>1048576</maxPartitionFetchBytes>
        <concurrency>6</concurrency>
      </consumer>
    </kafka>

    <scheduler>
      <enabled>true</enabled>
      <threadPoolSize>6</threadPoolSize>
      <jobs>
        <job name="metrics-rollup">
          <cron>0 */2 * * * *</cron>
          <enabled>true</enabled>
          <retry maxAttempts="3" backoffMs="1000"/>
        </job>
        <job name="anomaly-detect">
          <cron>0 */1 * * * *</cron>
          <enabled>true</enabled>
          <retry maxAttempts="2" backoffMs="1500"/>
        </job>
        <job name="cleanup-temp">
          <cron>0 0 */6 * * *</cron>
          <enabled>true</enabled>
          <retry maxAttempts="1" backoffMs="0"/>
        </job>
        <job name="refresh-feature-flags">
          <cron>0 */1 * * * *</cron>
          <enabled>true</enabled>
          <retry maxAttempts="3" backoffMs="500"/>
        </job>
      </jobs>
    </scheduler>
  </messaging>

  <services>
    <service name="config-ingest">
      <baseUrl>https://orion-uat.acme.example/ingest</baseUrl>
      <healthPath>/health</healthPath>
      <timeoutOverrides>
        <connectMs>2000</connectMs>
        <readMs>12000</readMs>
      </timeoutOverrides>
      <headers>
        <header name="X-Client" value="orion-core"/>
      </headers>
    </service>

    <service name="drift-analyzer">
      <baseUrl>https://orion-uat.acme.example/analyze</baseUrl>
      <healthPath>/health</healthPath>
      <timeoutOverrides>
        <connectMs>2000</connectMs>
        <readMs>15000</readMs>
      </timeoutOverrides>
    </service>

    <service name="rca-service">
      <baseUrl>https://rca-uat.acme.example/api</baseUrl>
      <healthPath>/actuator/health</healthPath>
      <timeoutOverrides>
        <connectMs>2500</connectMs>
        <readMs>20000</readMs>
      </timeoutOverrides>
      <auth>
        <type>service-token</type>
        <tokenRef>secret://svc/uat/rca_service_token</tokenRef>
      </auth>
    </service>

    <service name="notification-gateway">
      <baseUrl>https://notify-uat.acme.example</baseUrl>
      <healthPath>/health</healthPath>
      <rateLimit>
        <enabled>true</enabled>
        <requestsPerMinute>1200</requestsPerMinute>
        <burst>300</burst>
      </rateLimit>
    </service>

    <service name="grafana">
      <baseUrl>https://grafana-uat.acme.example</baseUrl>
      <apiPath>/api</apiPath>
      <auth>
        <type>api-key</type>
        <apiKeyRef>secret://grafana/uat/api_key</apiKeyRef>
      </auth>
    </service>

    <service name="prometheus">
      <baseUrl>https://prometheus-uat.acme.example</baseUrl>
      <queryPath>/api/v1/query</queryPath>
      <rangeQueryPath>/api/v1/query_range</rangeQueryPath>
      <auth>
        <type>basic</type>
        <username>orion-uat</username>
        <passwordRef>secret://prom/uat/basic_password</passwordRef>
      </auth>
    </service>

    <service name="loki">
      <baseUrl>https://loki-uat.acme.example</baseUrl>
      <queryPath>/loki/api/v1/query</queryPath>
      <rangeQueryPath>/loki/api/v1/query_range</rangeQueryPath>
      <auth>
        <type>basic</type>
        <username>orion-uat</username>
        <passwordRef>secret://loki/uat/basic_password</passwordRef>
      </auth>
    </service>
  </services>

  <observability>
    <logging>
      <level>DEBUG</level>
      <format>json</format>
      <includeMdc>true</includeMdc>
      <maskSecrets>true</maskSecrets>
      <appenders>
        <console enabled="true"/>
        <file enabled="true">
          <path>/var/log/orion/uat/orion-app.log</path>
          <rollingPolicy>
            <maxFileSizeMB>150</maxFileSizeMB>
            <maxHistoryDays>14</maxHistoryDays>
            <totalSizeCapGB>3</totalSizeCapGB>
          </rollingPolicy>
        </file>
      </appenders>

      <loggers>
        <logger name="org.hibernate.SQL" level="INFO"/>
        <logger name="com.acme.orion.security" level="DEBUG"/>
        <logger name="com.acme.orion.rca" level="DEBUG"/>
        <logger name="com.acme.orion.drift" level="DEBUG"/>
        <logger name="com.acme.orion.integrations" level="DEBUG"/>
      </loggers>
    </logging>

    <metrics>
      <prometheus enabled="true">
        <path>/metrics</path>
        <includeJvm>true</includeJvm>
        <includeHttp>true</includeHttp>
        <includeDb>true</includeDb>
        <histograms>
          <httpServerRequests enabled="true">
            <slaBucketsMs>
              <bucket>25</bucket>
              <bucket>50</bucket>
              <bucket>100</bucket>
              <bucket>250</bucket>
              <bucket>500</bucket>
              <bucket>1000</bucket>
              <bucket>2500</bucket>
              <bucket>5000</bucket>
            </slaBucketsMs>
          </httpServerRequests>
        </histograms>
      </prometheus>
    </metrics>

    <tracing>
      <enabled>true</enabled>
      <provider>otlp</provider>
      <sampling>
        <strategy>ratio</strategy>
        <ratio>0.25</ratio>
      </sampling>
      <otlp>
        <endpoint>https://otel-collector-uat.acme.example:4317</endpoint>
        <headers>
          <header name="x-otlp-token" valueRef="secret://otel/uat/token"/>
        </headers>
        <tls>
          <verify>true</verify>
        </tls>
      </otlp>
    </tracing>

    <alerts>
      <enabled>true</enabled>
      <rules>
        <rule id="UAT-CPU-HIGH">
          <severity>warning</severity>
          <condition>cpu_active_pct &gt; 80 for 5m</condition>
          <notify>
            <channel>slack</channel>
            <channel>email</channel>
          </notify>
        </rule>
        <rule id="UAT-ERROR-RATE">
          <severity>critical</severity>
          <condition>http_5xx_rate &gt; 3 for 2m</condition>
          <notify>
            <channel>slack</channel>
          </notify>
        </rule>
        <rule id="UAT-QUEUE-LAG">
          <severity>warning</severity>
          <condition>kafka_consumer_lag &gt; 20000 for 10m</condition>
          <notify>
            <channel>slack</channel>
          </notify>
        </rule>
      </rules>
    </alerts>
  </observability>

  <features>
    <source>redis</source>
    <refreshSeconds>60</refreshSeconds>
    <flags>
      <flag key="ui.newDashboard" enabled="true"/>
      <flag key="ui.betaTheme" enabled="true"/>
      <flag key="drift.semanticCompare" enabled="true"/>
      <flag key="drift.ignoreWhitespace" enabled="true"/>
      <flag key="drift.ignoreOrder" enabled="false"/>
      <flag key="rca.useRagPipeline" enabled="true"/>
      <flag key="rca.attachLogs" enabled="true"/>
      <flag key="rca.attachMetrics" enabled="true"/>
      <flag key="rca.maxContextTokens" enabled="true">
        <value>8000</value>
      </flag>
      <flag key="feedback.capture" enabled="true"/>
      <flag key="feedback.publicSharing" enabled="false"/>
      <flag key="integrations.appdynamics" enabled="true"/>
      <flag key="integrations.splunk" enabled="true"/>
      <flag key="integrations.github" enabled="true"/>
      <flag key="integrations.servicenow" enabled="false"/>
      <flag key="experiments.isolationForest" enabled="true"/>
      <flag key="experiments.thresholdFallback" enabled="true"/>
    </flags>
  </features>

  <driftPolicies>
    <baseline>
      <strategy>git-tag</strategy>
      <tagPrefix>baseline/uat</tagPrefix>
      <allowHotfixOverrides>true</allowHotfixOverrides>
      <overrideTtlHours>48</overrideTtlHours>
    </baseline>

    <comparison>
      <supportedTypes>
        <type name="xml">
          <normalize>
            <stripComments>true</stripComments>
            <trimWhitespace>true</trimWhitespace>
            <collapseRunsOfWhitespace>true</collapseRunsOfWhitespace>
            <canonicalizeEmptyElements>true</canonicalizeEmptyElements>
          </normalize>
          <semanticRules>
            <rule name="ignoreAttributeOrder" enabled="true"/>
            <rule name="ignoreNamespacePrefixes" enabled="true"/>
            <rule name="treatMissingOptionalAsDefault" enabled="true"/>
          </semanticRules>
        </type>

        <type name="json">
          <normalize>
            <sortKeys>true</sortKeys>
            <dropNulls>false</dropNulls>
            <coerceNumbers>true</coerceNumbers>
          </normalize>
          <semanticRules>
            <rule name="ignoreArrayOrder" enabled="false"/>
            <rule name="ignorePaths" enabled="true">
              <paths>
                <path>$.meta.build.gitCommit</path>
                <path>$.meta.build.buildDate</path>
                <path>$.runtime.instanceId</path>
              </paths>
            </rule>
          </semanticRules>
        </type>

        <type name="yaml">
          <normalize>
            <sortKeys>false</sortKeys>
            <resolveAnchors>true</resolveAnchors>
            <coerceBooleans>true</coerceBooleans>
          </normalize>
          <semanticRules>
            <rule name="ignorePaths" enabled="true">
              <paths>
                <path>meta.build.*</path>
                <path>runtime.instanceId</path>
              </paths>
            </rule>
          </semanticRules>
        </type>
      </supportedTypes>

      <severityMatrix>
        <dimension name="security">
          <critical>
            <pattern>tls.enabled changed</pattern>
            <pattern>auth.mode changed</pattern>
            <pattern>rbac.disabled</pattern>
          </critical>
          <high>
            <pattern>allowedCidrs expanded</pattern>
            <pattern>passwordRef changed</pattern>
          </high>
          <medium>
            <pattern>log.maskSecrets changed</pattern>
          </medium>
        </dimension>

        <dimension name="performance">
          <critical>
            <pattern>maxConnections decreased &gt; 50%</pattern>
            <pattern>timeouts increased &gt; 2x</pattern>
          </critical>
          <high>
            <pattern>pool.maxConnections changed</pattern>
          </high>
          <medium>
            <pattern>cache.ttl changed</pattern>
          </medium>
        </dimension>

        <dimension name="functional">
          <critical>
            <pattern>service.baseUrl changed</pattern>
            <pattern>feature.enabled changed for rca.useRagPipeline</pattern>
          </critical>
          <high>
            <pattern>topic.partitions changed</pattern>
          </high>
          <medium>
            <pattern>cron schedule changed</pattern>
          </medium>
        </dimension>
      </severityMatrix>
    </comparison>

    <reporting>
      <format>html</format>
      <includeDiffSnippets>true</includeDiffSnippets>
      <snippetContextLines>4</snippetContextLines>
      <includeRiskRationale>true</includeRiskRationale>
      <includeSuggestedRemediation>true</includeSuggestedRemediation>
      <includeOwnerHints>true</includeOwnerHints>
      <maxFindingsPerFile>2500</maxFindingsPerFile>
    </reporting>
  </driftPolicies>

  <rateLimiting>
    <enabled>true</enabled>
    <mode>token-bucket</mode>
    <storage>redis</storage>

    <globalLimits>
      <requestsPerMinute>6000</requestsPerMinute>
      <burst>1200</burst>
      <perIp enabled="true">
        <requestsPerMinute>900</requestsPerMinute>
        <burst>250</burst>
      </perIp>
      <perUser enabled="true">
        <requestsPerMinute>1200</requestsPerMinute>
        <burst>300</burst>
      </perUser>
    </globalLimits>

    <routes>
      <route path="/orion/api/v1/drift/compare">
        <requestsPerMinute>600</requestsPerMinute>
        <burst>120</burst>
      </route>
      <route path="/orion/api/v1/rca/analyze">
        <requestsPerMinute>240</requestsPerMinute>
        <burst>60</burst>
      </route>
      <route path="/orion/api/v1/feedback">
        <requestsPerMinute>900</requestsPerMinute>
        <burst>200</burst>
      </route>
      <route path="/orion/api/v1/admin/*">
        <requestsPerMinute>120</requestsPerMinute>
        <burst>30</burst>
        <requiresRole>admin</requiresRole>
      </route>
    </routes>
  </rateLimiting>

  <ai>
    <provider>external-api</provider>
    <modelRouting>
      <defaultModel>sonar-medium</defaultModel>
      <routes>
        <route task="rca.summary" model="sonar-medium" maxTokens="900" temperature="0.3"/>
        <route task="rca.deep" model="sonar-large" maxTokens="1400" temperature="0.25"/>
        <route task="diff.explain" model="sonar-medium" maxTokens="800" temperature="0.2"/>
        <route task="remediation.plan" model="sonar-large" maxTokens="1200" temperature="0.35"/>
      </routes>
    </modelRouting>

    <api>
      <baseUrl>https://llm-uat.acme.example/v1</baseUrl>
      <timeoutMs>25000</timeoutMs>
      <apiKeyRef>secret://llm/uat/api_key</apiKeyRef>
      <maxConcurrentRequests>8</maxConcurrentRequests>
      <backpressure>
        <queueSize>200</queueSize>
        <rejectWhenFull>true</rejectWhenFull>
      </backpressure>
    </api>

    <prompting>
      <templates>
        <template name="rca-header">
          <text>Generate a root-cause analysis for the anomaly. Be specific. Reference metrics and logs.</text>
        </template>
        <template name="diff-header">
          <text>Explain configuration differences. Focus on risk, impact, and remediation.</text>
        </template>
        <template name="feedback-header">
          <text>Incorporate human feedback. Improve future explanations without repeating mistakes.</text>
        </template>
      </templates>

      <guardrails>
        <piiDetection enabled="true">
          <action>redact</action>
        </piiDetection>
        <secretsDetection enabled="true">
          <action>block</action>
        </secretsDetection>
        <allowedDataClasses>
          <class>metrics</class>
          <class>logs</class>
          <class>config</class>
          <class>topology</class>
        </allowedDataClasses>
      </guardrails>
    </prompting>
  </ai>

  <ui>
    <branding>
      <title>Orion (UAT)</title>
      <logoPath>/static/uat/orion-logo.svg</logoPath>
      <theme>dark-beta</theme>
    </branding>

    <navigation>
      <menu>
        <item key="dashboard" label="Dashboards" path="/ui/dashboards"/>
        <item key="drift" label="Config Drift" path="/ui/drift"/>
        <item key="anomalies" label="Anomalies" path="/ui/anomalies"/>
        <item key="rca" label="RCA Reports" path="/ui/rca"/>
        <item key="feedback" label="Feedback" path="/ui/feedback"/>
        <item key="admin" label="Admin" path="/ui/admin" requiresRole="admin"/>
      </menu>
    </navigation>

    <tables>
      <pageSizeDefault>25</pageSizeDefault>
      <pageSizeOptions>
        <size>10</size>
        <size>25</size>
        <size>50</size>
        <size>100</size>
      </pageSizeOptions>
      <export>
        <csv enabled="true"/>
        <json enabled="true"/>
      </export>
    </tables>

    <session>
      <cookieName>ORION_UAT_SID</cookieName>
      <timeoutMinutes>90</timeoutMinutes>
      <sliding>true</sliding>
      <sameSite>Lax</sameSite>
      <secure>true</secure>
    </session>
  </ui>

</appConfig>
